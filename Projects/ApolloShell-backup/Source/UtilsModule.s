;--T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T---T
;-----------------------------------------------------------------------------
;	Project		Apollo V4 development - Shell
;	File		UtilsModule.c
;	Coder		Neil Beresford
;	Build envrn	ASMPro V1.20b
;-----------------------------------------------------------------------------
;	Notes
;
;-----------------------------------------------------------------------------

;-----------------------------------------------------------------------------
; Defines
;-----------------------------------------------------------------------------

MASKFIRSTTWOBITS		=	$00000003

;-----------------------------------------------------------------------------
; Code
;-----------------------------------------------------------------------------


	SECTION utils,CODE_F	

;-----------------------------------------------------------------------------

; Memory handling

;-----------------------------------------------------------------------------

;----------------------------------------------------------
; UtilsModule_ClearMem
; Clears the memory, Longs then bytes
; Regs -
;	D0 - total memory
;  A0 - pointer to the memory to be cleared
; Trashed -
;  None
;----------------------------------------------------------
UtilsModule_ClearMem:

	movem.l	d0-d2/a0,-(SP)

	; D0 - Total amount to clear
	; A0 - Pointer to the start of memory	

	; Clear the ints first...

	clr.l	d2
	move.l	d0,d1

	asl.l	#2,d0

.longs:

	move.l	d2,(a0)+
	dbpl	d0,.longs	

	; now the old bytes at the end
	
	and.l	#MASKFIRSTTWOBITS,d1
	beq.s	.longs
	
.bytes:	

	move.b	d2,(A0)+
	dbpl	d1,.bytes	

.end:

	movem.l (SP)+,d0-d2/a0
	rts

;-----------------------------------------------------------------------------
; Data
;-----------------------------------------------------------------------------

;-----------------------------------------------------------------------------
; End of file: UtilModule.s
;-----------------------------------------------------------------------------

